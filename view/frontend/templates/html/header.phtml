<?php
/**
 * @var $block \CravenDunnill\Header\Block\Html\Header
 */
?>
<div class="cd-header-container">
	<!-- Desktop Header -->
	<div class="cd-header-desktop">
		<div class="cd-header-left">
			<a href="#" class="cd-search-button" id="cd-search-button">
				<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
					<circle cx="11" cy="11" r="8"></circle>
					<line x1="21" y1="21" x2="16.65" y2="16.65"></line>
				</svg>
				<span>Search</span>
			</a>
		</div>
		
		<div class="cd-header-center">
			<a class="cd-logo" href="<?= $block->getBaseUrl() ?>">
				<img src="<?= $block->getViewFileUrl('CravenDunnill_Header::images/logo.svg') ?>" alt="Craven Dunnill" height="30">
				<div class="cd-tagline">SINCE 1872</div>
			</a>
		</div>
		
		<div class="cd-header-right">
			<a class="cd-header-icon" href="<?= $block->getWishlistUrl() ?>">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
					<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
				</svg>
				<span>Your Project</span>
			</a>
			
			<a class="cd-header-icon" href="<?= $block->getAccountUrl() ?>">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
					<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
					<circle cx="12" cy="7" r="4"></circle>
				</svg>
				<span>Account</span>
			</a>
			
			<!-- Cart icon will be placed here by cart-icons.phtml -->
		</div>
	</div>

	<!-- Mobile Header -->
	<div class="cd-header-mobile">
		<div class="cd-header-mobile-left">
			<div class="cd-menu-button" id="cd-menu-button">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<line x1="3" y1="12" x2="21" y2="12"></line>
					<line x1="3" y1="6" x2="21" y2="6"></line>
					<line x1="3" y1="18" x2="21" y2="18"></line>
				</svg>
			</div>
			
			<!-- Search button moved here -->
			<a href="#" class="cd-search-button-mobile" id="cd-search-button-mobile">
				<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
					<circle cx="11" cy="11" r="8"></circle>
					<line x1="21" y1="21" x2="16.65" y2="16.65"></line>
				</svg>
			</a>
			
			<a class="cd-logo-mobile" href="<?= $block->getBaseUrl() ?>">
				<img src="<?= $block->getViewFileUrl('CravenDunnill_Header::images/logo.svg') ?>" alt="Craven Dunnill" height="30">
			</a>
		</div>
		
		<div class="cd-header-mobile-right">
			<a class="cd-header-icon-mobile" href="<?= $block->getWishlistUrl() ?>">
				<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
					<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
				</svg>
			</a>
			
			<a class="cd-header-icon-mobile" href="<?= $block->getAccountUrl() ?>">
				<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
					<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
					<circle cx="12" cy="7" r="4"></circle>
				</svg>
			</a>
			
			<!-- Mobile cart icon will be placed here by cart-icons.phtml -->
		</div>
	</div>
	
	<!-- Search Panel -->
	<div class="cd-search-panel" id="cd-search-panel" style="display: none;">
		<div class="cd-search-panel-inner">
			<form class="cd-search-form" action="<?= $block->getSearchUrl() ?>" method="get">
				<div class="cd-search-input-wrapper">
					<input type="text" name="q" id="cd-search-input" class="cd-search-input" placeholder="Search products..." autocomplete="off">
					<button type="submit" class="cd-search-submit">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="11" cy="11" r="8"></circle>
							<line x1="21" y1="21" x2="16.65" y2="16.65"></line>
						</svg>
					</button>
				</div>
				<button type="button" class="cd-search-close" id="cd-search-close">
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<line x1="18" y1="6" x2="6" y2="18"></line>
						<line x1="6" y1="6" x2="18" y2="18"></line>
					</svg>
				</button>
			</form>
		</div>
	</div>
	
	<!-- Cart Icons -->
	<?= $block->getChildHtml('cart_icons') ?>
	
	<!-- Add to cart handler initialization -->
	<script type="text/x-magento-init">
	{
		"*": {
			"cravendunnill-add-to-cart-override": {}
		}
	}
	</script>
	
	<!-- Mobile Menu Slide-out -->
	<div class="cd-mobile-menu" id="cd-mobile-menu">
		<div class="cd-mobile-menu-header">
			<h3>Shop Craven Dunnill</h3>
			<button type="button" class="cd-mobile-menu-close" id="cd-mobile-menu-close">
				<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<line x1="18" y1="6" x2="6" y2="18"></line>
					<line x1="6" y1="6" x2="18" y2="18"></line>
				</svg>
			</button>
		</div>
		<div class="cd-mobile-menu-content">
			<nav class="cd-mobile-nav">
				<ul class="cd-mobile-nav-list">
					<li class="cd-mobile-nav-item">
						<a href="<?= $block->getBaseUrl() ?>" class="cd-mobile-nav-link">Home</a>
					</li>
					
					<?php
					// Get category structure
					$objectManager = \Magento\Framework\App\ObjectManager::getInstance();
					$categoryHelper = $objectManager->get('\Magento\Catalog\Helper\Category');
					$categoryFactory = $objectManager->get('\Magento\Catalog\Model\CategoryFactory');
					$storeManager = $objectManager->get('\Magento\Store\Model\StoreManagerInterface');
					
					// Get store ID
					$storeId = $storeManager->getStore()->getId();
					
					// Get root category ID
					$rootCategoryId = $storeManager->getStore($storeId)->getRootCategoryId();
					
					// Get category object
					$rootCategory = $categoryFactory->create()->load($rootCategoryId);
					
					// Get all categories under root
					$topCategories = $rootCategory->getChildrenCategories();
					
					// Output categories
					foreach ($topCategories as $category):
						if (!$category->getIsActive()) continue; // Skip inactive categories
					?>
						<li class="cd-mobile-nav-item has-children">
							<a href="<?= $categoryHelper->getCategoryUrl($category) ?>" class="cd-mobile-nav-link">
								<?= $category->getName() ?>
							</a>
							<?php
							// Check for subcategories
							$subcategories = $category->getChildrenCategories();
							if (count($subcategories)): 
							?>
								<span class="cd-mobile-nav-toggle">
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
										<polyline points="6 9 12 15 18 9"></polyline>
									</svg>
								</span>
								<ul class="cd-mobile-nav-sublist">
									<?php foreach ($subcategories as $subcategory):
										if (!$subcategory->getIsActive()) continue; // Skip inactive subcategories 
									?>
										<li class="cd-mobile-nav-subitem">
											<a href="<?= $categoryHelper->getCategoryUrl($subcategory) ?>" class="cd-mobile-nav-sublink">
												<?= $subcategory->getName() ?>
											</a>
										</li>
									<?php endforeach; ?>
								</ul>
							<?php endif; ?>
						</li>
					<?php endforeach; ?>
					
					<li class="cd-mobile-nav-item">
						<a href="/delivery/" class="cd-mobile-nav-link">Delivery</a>
					</li>
					<li class="cd-mobile-nav-item">
						<a href="/contact/" class="cd-mobile-nav-link">Contact</a>
					</li>
				</ul>
			</nav>
		</div>
		<!-- Mobile account footer with button styling -->
		<div class="cd-mobile-account-footer">
			<a href="<?= $block->getAccountUrl() ?>" class="cd-mobile-account-link">
				<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
					<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
					<circle cx="12" cy="7" r="4"></circle>
				</svg>
				ACCOUNT
			</a>
			<a href="<?= $block->getWishlistUrl() ?>" class="cd-mobile-account-link">
				<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#122C58" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
					<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
				</svg>
				YOUR PROJECT
			</a>
		</div>
	</div>
	
	<!-- Simple Overlay -->
	<div class="cd-overlay" id="cd-overlay"></div>
	
	<script>
		// IMPORTANT: This script moves the overlay to prevent it from covering the header
		(function() {
			// Function to reposition the overlay so it doesn't cover header
			function fixOverlayPosition() {
				var overlay = document.getElementById('cd-overlay');
				var pageMain = document.querySelector('.page-main');
				
				if (overlay && pageMain) {
					// Only move if not already positioned correctly
					if (overlay.parentNode !== pageMain) {
						// Clone the overlay to preserve event handlers
						var newOverlay = overlay.cloneNode(true);
						
						// Remove the original
						overlay.parentNode.removeChild(overlay);
						
						// Add the clone to page-main
						pageMain.insertBefore(newOverlay, pageMain.firstChild);
						
						// Fix positioning
						newOverlay.style.position = 'absolute';
						newOverlay.style.top = '0';
						newOverlay.style.left = '0';
						newOverlay.style.right = '0';
						newOverlay.style.bottom = '0';
						newOverlay.style.zIndex = '100';
						
						// Reattach event listeners if needed
						newOverlay.addEventListener('click', function() {
							document.getElementById('cd-search-panel').style.display = 'none';
							newOverlay.style.display = 'none';
							
							// Close mini cart if open
							var minicart = document.getElementById('cd-minicart');
							if (minicart) {
								minicart.classList.remove('active');
							}
							
							// Close mobile menu if open
							var mobileMenu = document.getElementById('cd-mobile-menu');
							if (mobileMenu) {
								mobileMenu.classList.remove('active');
							}
							
							// Remove blur from all elements
							document.querySelectorAll('.page-main, .page-footer, .nav-sections, .breadcrumbs').forEach(function(el) {
								if (el) el.style.filter = 'none';
							});
						});
					}
				}
				
				// Ensure header elements have the highest z-index
				var headerElements = [
					'.page-header',
					'header.page-header',
					'.cd-header-container',
					'.cd-header-desktop',
					'.cd-header-mobile',
					'.cd-header-left',
					'.cd-header-right',
					'.cd-header-center'
				];
				
				headerElements.forEach(function(selector) {
					document.querySelectorAll(selector).forEach(function(el) {
						if (el) {
							el.style.position = 'relative';
							el.style.zIndex = '1200';
							el.style.filter = 'none';
							el.style.opacity = '1';
							el.style.visibility = 'visible';
						}
					});
				});
			}
			
			// Run immediately
			fixOverlayPosition();
			
			// Also run when DOM is ready
			document.addEventListener('DOMContentLoaded', function() {
				console.log('Header overlay fix loaded');
				fixOverlayPosition();
				
				// Enhanced close button functionality
				var searchCloseButton = document.getElementById('cd-search-close');
				if (searchCloseButton) {
					// Remove any existing handlers
					var newSearchCloseButton = searchCloseButton.cloneNode(true);
					searchCloseButton.parentNode.replaceChild(newSearchCloseButton, searchCloseButton);
					
					// Add new, more direct handler
					newSearchCloseButton.addEventListener('click', function(e) {
						e.preventDefault();
						e.stopPropagation();
						console.log('Search close button clicked - enhanced inline handler');
						
						// Hide search panel
						var searchPanel = document.getElementById('cd-search-panel');
						if (searchPanel) searchPanel.style.display = 'none';
						
						// Find and hide overlay (handle both relocated and original positions)
						var pageMainOverlay = document.querySelector('.page-main #cd-overlay');
						if (pageMainOverlay) pageMainOverlay.style.display = 'none';
						
						var originalOverlay = document.querySelector('#cd-overlay:not(.page-main #cd-overlay)');
						if (originalOverlay) originalOverlay.style.display = 'none';
						
						// Remove blur from content
						document.querySelectorAll('.page-main, .page-footer, .nav-sections, .breadcrumbs').forEach(function(el) {
							if (el) el.style.filter = 'none';
						});
						
						return false;
					});
				}
				
				// Search button click handler
				document.getElementById('cd-search-button').addEventListener('click', function(e) {
					e.preventDefault();
					console.log('Search button clicked');
					
					// Ensure overlay is properly positioned
					fixOverlayPosition();
					
					// Now, safely display the search panel
					document.getElementById('cd-search-panel').style.display = 'block';
					
					// Get the repositioned overlay
					var overlay = document.querySelector('.page-main #cd-overlay');
					if (overlay) {
						overlay.style.display = 'block';
					}
					
					// Apply blur only to main content
					document.querySelectorAll('.page-main, .page-footer, .nav-sections, .breadcrumbs').forEach(function(el) {
						if (el) el.style.filter = 'blur(4px)';
					});
					
					// Force header elements to be visible
					document.querySelectorAll('.page-header, header.page-header, .cd-header-container').forEach(function(el) {
						if (el) {
							el.style.position = 'relative';
							el.style.zIndex = '1200';
							el.style.filter = 'none';
							el.style.opacity = '1';
							el.style.visibility = 'visible';
						}
					});
					
					// Focus search input
					setTimeout(function() {
						document.getElementById('cd-search-input').focus();
					}, 100);
				});
				
				// Also add handler for mobile search button
				if (document.getElementById('cd-search-button-mobile')) {
					document.getElementById('cd-search-button-mobile').addEventListener('click', function(e) {
						e.preventDefault();
						console.log('Mobile search button clicked');
						
						// Ensure overlay is properly positioned
						fixOverlayPosition();
						
						// Now, safely display the search panel
						document.getElementById('cd-search-panel').style.display = 'block';
						
						// Get the repositioned overlay
						var overlay = document.querySelector('.page-main #cd-overlay');
						if (overlay) {
							overlay.style.display = 'block';
						}
						
						// Apply blur only to main content
						document.querySelectorAll('.page-main, .page-footer, .nav-sections, .breadcrumbs').forEach(function(el) {
							if (el) el.style.filter = 'blur(4px)';
						});
						
						// Force header elements to be visible
						document.querySelectorAll('.page-header, header.page-header, .cd-header-container').forEach(function(el) {
							if (el) {
								el.style.position = 'relative';
								el.style.zIndex = '1200';
								el.style.filter = 'none';
								el.style.opacity = '1';
								el.style.visibility = 'visible';
							}
						});
						
						// Focus search input
						setTimeout(function() {
							document.getElementById('cd-search-input').focus();
						}, 100);
					});
				}
			});
			
			// Also run on window load
			window.addEventListener('load', fixOverlayPosition);
		})();
	</script>
	
	<!-- Mobile menu JavaScript -->
	<script>
	require(['jquery'], function($) {
		'use strict';
		
		$(document).ready(function() {
			// Function to prevent body scroll
			function preventBodyScroll() {
				// Save current scroll position
				var scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
				
				// Store this value so we can restore it later
				window.lastScrollPosition = scrollPosition;
				
				// Apply necessary classes
				document.documentElement.classList.add('scroll-locked');
				document.body.classList.add('scroll-locked');
				
				// Make absolutely sure the body is locked at the current scroll position
				setTimeout(function() {
					document.body.style.setProperty('top', `-${scrollPosition}px`, 'important');
				}, 0);
			}

			// Function to allow body scroll
			function allowBodyScroll() {
				// Remove applied classes
				document.documentElement.classList.remove('scroll-locked');
				document.body.classList.remove('scroll-locked');
				
				// Reset any inline styles
				document.body.style.removeProperty('overflow');
				document.body.style.removeProperty('position');
				document.body.style.removeProperty('height');
				document.body.style.removeProperty('width');
				document.body.style.removeProperty('top');
				
				// Restore scroll position
				const scrollPosition = window.lastScrollPosition || 0;
				window.scrollTo(0, scrollPosition);
			}
			
			// Mobile menu toggle button
			$('#cd-menu-button').on('click', function(e) {
				e.preventDefault();
				e.stopPropagation();
				
				console.log('Mobile menu button clicked');
				
				// Show mobile menu
				$('#cd-mobile-menu').addClass('active');
				
				// Show overlay
				$('#cd-overlay').css('display', 'block');
				
				// Apply blur effect to content
				$('.page-main, .page-footer, .nav-sections, .breadcrumbs').css('filter', 'blur(4px)');
				
				// Prevent body scrolling
				preventBodyScroll();
			});
			
			// Mobile menu close button
			$('#cd-mobile-menu-close').on('click', function(e) {
				e.preventDefault();
				
				// Hide mobile menu
				$('#cd-mobile-menu').removeClass('active');
				
				// Hide overlay
				$('#cd-overlay').css('display', 'none');
				
				// Remove blur effect
				$('.page-main, .page-footer, .nav-sections, .breadcrumbs').css('filter', 'none');
				
				// Allow body scroll
				allowBodyScroll();
			});
			
			// Mobile submenu toggle
			$('.cd-mobile-nav-toggle').on('click', function(e) {
				e.preventDefault();
				e.stopPropagation();
				
				var $this = $(this);
				var $sublist = $this.siblings('.cd-mobile-nav-sublist');
				
				// Toggle active class for arrow rotation
				$this.toggleClass('active');
				
				// Toggle submenu visibility
				$sublist.toggleClass('active');
				
				// Prevent event bubbling to parent elements
				return false;
			});
			
			// Overlay click
			$('#cd-overlay').on('click', function() {
				console.log('Overlay clicked');
				
				// Hide search panel
				$('#cd-search-panel').hide();
				
				// Hide mobile menu
				$('#cd-mobile-menu').removeClass('active');
				
				// Hide overlay
				$(this).css('display', 'none');
				
				// Remove blur effect
				$('.page-main, .page-footer, .nav-sections, .breadcrumbs').css('filter', 'none');
				
				// Allow body scroll
				allowBodyScroll();
			});
			
			// Escape key handler
			$(document).keyup(function(e) {
				if (e.key === "Escape") {
					$('#cd-search-panel').hide();
					$('#cd-mobile-menu').removeClass('active');
					$('#cd-overlay').hide();
					$('.page-main, .page-footer, .nav-sections, .breadcrumbs').css('filter', 'none');
					allowBodyScroll();
				}
			});
		});
	});
	</script>
</div>


<!-- Emergency Mobile Cart Fix -->
<style>
@media screen and (max-width: 767px) {
	/* Force minicart to display correctly */
	.cd-minicart {
		top: 0 !important;
		right: -100vw !important;
		width: 100vw !important;
		height: 100vh !important;
		position: fixed !important;
		z-index: 99999 !important;
		transition: none !important;
		transform: none !important;
		display: block !important;
		background-color: #fff !important;
	}
	
	.cd-minicart.active {
		right: 0 !important;
		opacity: 1 !important;
		visibility: visible !important;
	}
	
	/* Fix body scroll issues */
	html.scroll-locked,
	body.scroll-locked {
		overflow: hidden !important;
		height: 100% !important;
		width: 100% !important;
		position: fixed !important;
	}
	
	/* Make content visible */
	.cd-minicart-content {
		display: block !important;
		visibility: visible !important;
		max-height: 70vh !important;
	}
}
</style>

<script>
// Emergency Mobile Cart Fix
(function() {
	// Only run on mobile
	if (window.innerWidth > 767) return;
	
	console.log("Mobile cart emergency fix active");
	
	// Define simple open minicart function
	window.mobileOpenCart = function() {
		console.log("Mobile: Opening cart");
		
		// Force display settings
		document.getElementById('cd-minicart').style.display = 'block';
		document.getElementById('cd-minicart').style.visibility = 'visible';
		document.getElementById('cd-minicart').style.opacity = '1';
		document.getElementById('cd-minicart').style.right = '0';
		document.getElementById('cd-minicart').classList.add('active');
		
		// Show overlay
		document.getElementById('cd-overlay').style.display = 'block';
		
		// Lock scrolling
		document.documentElement.style.overflow = 'hidden';
		document.body.style.overflow = 'hidden';
		document.body.style.position = 'fixed';
		document.body.style.width = '100%';
		document.body.style.height = '100%';
		
		return false;
	};
	
	// Override existing functions
	window.forceOpenMinicart = window.mobileOpenCart;
	
	// Capture add to cart events
	document.addEventListener('click', function(e) {
		// Match add to cart buttons
		if (e.target.matches('button.action.tocart') || 
			e.target.closest('button.action.tocart')) {
			console.log("Mobile: Detected add to cart click");
			setTimeout(window.mobileOpenCart, 1000);
		}
	}, true);
	
	// Intercept AJAX cart requests
	var origOpen = XMLHttpRequest.prototype.open;
	XMLHttpRequest.prototype.open = function() {
		this.addEventListener('load', function() {
			if (this.responseURL && this.responseURL.indexOf('checkout/cart/add') > -1) {
				console.log("Mobile: Detected cart AJAX success");
				setTimeout(window.mobileOpenCart, 500);
			}
		});
		origOpen.apply(this, arguments);
	};
})();
</script>

<!-- Mobile Cart Fix for Close Button -->
<script>
(function() {
	// Only run on mobile
	if (window.innerWidth > 767) return;
	
	console.log("Mobile cart close fix active");
	
	// Handle closing the cart
	window.mobileCloseCart = function() {
		console.log("Mobile: Closing cart");
		
		// Hide minicart
		document.getElementById('cd-minicart').classList.remove('active');
		document.getElementById('cd-minicart').style.right = '-100vw';
		
		// Hide overlay
		document.getElementById('cd-overlay').style.display = 'none';
		
		// Unlock scrolling
		document.documentElement.style.overflow = '';
		document.documentElement.style.position = '';
		document.documentElement.style.height = '';
		document.documentElement.style.width = '';
		
		document.body.style.overflow = '';
		document.body.style.position = '';
		document.body.style.height = '';
		document.body.style.width = '';
		document.body.style.top = '';
		
		// Restore scroll position
		var scrollY = parseInt(document.body.style.top || '0');
		if (scrollY) {
			window.scrollTo(0, Math.abs(scrollY));
		}
		
		// Remove any other classes
		document.documentElement.classList.remove('scroll-locked');
		document.body.classList.remove('scroll-locked');
		
		return false;
	};
	
	// Attach event handler to close button
	document.addEventListener('click', function(e) {
		if (e.target.matches('#cd-minicart-close') || 
			e.target.closest('#cd-minicart-close')) {
			return mobileCloseCart();
		}
		
		// Also handle overlay clicks
		if (e.target.matches('#cd-overlay')) {
			return mobileCloseCart();
		}
	}, true);
	
	// Also override any existing close functions
	var checkInterval = setInterval(function() {
		if (document.getElementById('cd-minicart-close')) {
			document.getElementById('cd-minicart-close').onclick = mobileCloseCart;
			clearInterval(checkInterval);
		}
	}, 100);
})();
</script>